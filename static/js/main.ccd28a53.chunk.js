(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{109:function(e,t,n){},171:function(e,t,n){},193:function(e,t,n){},196:function(e,t,n){},340:function(e,t,n){"use strict";n.r(t);var c=n(0),r=n.n(c),s=n(13),i=n.n(s),a=(n(171),n(109),n(64)),o=n(16),l=n(91),u=n(147),j=n(105),d=n.n(j),b=n(145),h=n(38),O=n(146),p=n.n(O).a.create({baseURL:"https://chat-onlineyanky.herokuapp.com/"}),g=function(e){return p.post("auth/me",e).then((function(e){return e.data}))},f=function(e){return p.post("/auth/registration",e).then((function(e){return e.data}))},x={login:"",isAuth:!1,initApp:!1,error:"",success:""},m="IS-AUTH",v="INIT-APP",w="ERROR",S="SUCCESS";var k=function(e,t){return{type:m,login:e,isAuth:t}},N=function(e){return{type:v,isInit:e}},y=function(e){return{type:w,error:e}},T=function(e){return{type:S,success:e}},A=function(e){g({acTkn:localStorage.getItem("acTkn")}).then((function(t){return 1===t.responseCode&&e(k(t.login,!0))})).finally((function(){return e(N(!0))}))},I=function(e){return function(t){var n;(n=e,p.post("auth/login",n).then((function(e){return e.data}))).then((function(e){0===e.responseCode?t(y(e.message)):localStorage.setItem("acTkn",e.acTkn),g({acTkn:localStorage.getItem("acTkn")}).then((function(e){1===e.responseCode&&t(k(e.login,!0))}))}))}},C=function(e){localStorage.setItem("acTkn",""),g({acTkn:localStorage.getItem("acTkn")}).then((function(t){return 0===t.responseCode&&e(k(t.login,!1))}))},E=n(165),P={items:[]},R="GET-MESSAGES";var V,_=function(e){return{type:R,messages:e}},U=Object(l.b)({auth:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:x,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case m:return Object(h.a)(Object(h.a)({},e),{},{login:t.login,isAuth:t.isAuth,error:""});case v:return Object(h.a)(Object(h.a)({},e),{},{initApp:t.isInit});case w:return Object(h.a)(Object(h.a)({},e),{},{error:t.error,success:""});case S:return Object(h.a)(Object(h.a)({},e),{},{success:t.success,error:""});default:return e}},chat:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:P,t=arguments.length>1?arguments[1]:void 0;return t.type===R?Object(h.a)(Object(h.a)({},e),{},{items:Object(E.a)(t.messages)}):e}}),G=Object(l.c)(U,Object(l.a)(u.a)),J=(n(193),n(7)),L=n.n(J),M=function(e){return e.auth},z=function(e){return e.chat.items},B=n(3),D=function(){var e=Object(o.c)(),t=Object(o.d)(M);return Object(B.jsx)("header",{className:L()("header","clearfix"),children:t.isAuth?Object(B.jsxs)("div",{className:"logout",children:[Object(B.jsx)("div",{children:t.login}),Object(B.jsx)("div",{children:Object(B.jsx)("button",{onClick:function(){return e(C)},children:"Logout"})})]}):Object(B.jsxs)("div",{className:"autorization",children:[Object(B.jsx)(a.b,{onClick:function(){return e(y(""))},to:"login",children:Object(B.jsx)("span",{children:"Sign in"})}),Object(B.jsx)(a.b,{onClick:function(){return e(y(""))},to:"registration",children:Object(B.jsx)("span",{children:"Sign up"})})]})})},F=n(10),H=(n(196),n(166)),q=n(163),K=function(){var e=Object(c.useRef)(null),t=Object(c.useState)(""),n=Object(H.a)(t,2),r=n[0],s=n[1],i=Object(o.c)(),a=Object(o.d)(z);Object(c.useEffect)((function(){(V=Object(q.a)("https://chat-onlineyanky.herokuapp.com")).on("messages",(function(t){var n;console.log(t),i(_(t)),null===(n=e.current)||void 0===n||n.scrollIntoView()}))}),[]);var l=Object(o.d)(M);return Object(B.jsxs)("div",{className:"chat",children:[Object(B.jsx)("div",{className:"chat_title",children:"Online chat"}),Object(B.jsxs)("div",{className:"chat_messages",children:[a.map((function(e){return Object(B.jsxs)("div",{children:[Object(B.jsx)("div",{className:L()("user",{me:l.login===e.user}),children:Object(B.jsx)("span",{children:e.user})}),Object(B.jsx)("div",{className:L()("message",{me:l.login===e.user}),children:Object(B.jsx)("span",{children:e.message})})]})})),Object(B.jsx)("div",{ref:e})]}),Object(B.jsx)("form",{onSubmit:function(e){return e.preventDefault()},children:Object(B.jsxs)("div",{className:"chat_footer",children:[Object(B.jsx)("input",{value:r,placeholder:"\u0422\u0435\u043a\u0441\u0442 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f",onChange:function(e){var t;(t=e.currentTarget.value).length<150&&s(t)}}),Object(B.jsx)("button",{onClick:function(){r&&r.length<150&&(V.emit("message",{message:r,acTkn:localStorage.getItem("acTkn")}),s(""))},children:"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c"})]})})]})},Q=n(107),W=n.n(Q),X=n(42);function Y(e){var t;return e.length>40&&(t="\u041c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u0430\u044f \u0434\u043b\u0438\u043d\u0430 \u043f\u043e\u043b\u044f 40 \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432"),e&&e.length<10&&(t="\u041c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u0430\u044f \u0434\u043b\u0438\u043d\u0430 \u043f\u043e\u043b\u044f 10 \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432"),t}function Z(e){var t;return e.length>40&&(t="\u041c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u0430\u044f \u0434\u043b\u0438\u043d\u0430 \u043f\u043e\u043b\u044f 40 \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432"),e&&e.length<10&&(t="\u041c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u0430\u044f \u0434\u043b\u0438\u043d\u0430 \u043f\u043e\u043b\u044f 10 \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432"),t}n(120);var $=function(){var e=Object(o.d)(M),t=Object(o.c)();return Object(B.jsxs)("div",{className:"auth",children:[Object(B.jsx)("div",{className:"auth_title",children:"Sign in"}),Object(B.jsx)(X.c,{initialValues:{login:"",password:""},onSubmit:function(e){!function(e){t(I(e))}(e)},children:function(e){var t=e.errors,n=e.touched;e.isValidating;return Object(B.jsxs)(X.b,{children:[Object(B.jsx)(W.a,{visible:!(!t.login||!n.login),placement:"right",title:Object(B.jsx)("span",{children:t.login}),children:Object(B.jsx)(X.a,{id:"login",name:"login",placeholder:"login",validate:Y})}),Object(B.jsx)(W.a,{visible:!(!t.password||!n.password),placement:"left",title:Object(B.jsx)("span",{children:t.password}),children:Object(B.jsx)(X.a,{id:"password",name:"password",placeholder:"password",validate:Z})}),Object(B.jsx)("button",{type:"submit",children:"Submit"})]})}}),Object(B.jsx)("div",{className:"error",children:e.error&&Object(B.jsx)("span",{children:e.error})})]})},ee=n(344),te=Object(o.b)((function(e){return{auth:M(e)}}),(function(e){return{reg:function(t){return e((n=t,function(e){return new Promise(function(){var t=Object(b.a)(d.a.mark((function t(c){var r;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,f(n);case 3:1===(r=t.sent).responseCode&&e(T(r.message)),e(y(r.message)),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),console.log(t.t0);case 11:case"end":return t.stop()}}),t,null,[[0,8]])})));return function(e){return t.apply(this,arguments)}}())}));var n}}}))((function(e){var t=e.auth,n=e.reg;return Object(B.jsxs)("div",{className:"auth",children:[Object(B.jsx)("div",{className:"auth_title",children:"Sign up"}),Object(B.jsx)(X.c,{initialValues:{login:"",password:"",repeatPassword:""},onSubmit:function(e,c){!function(e,c){n(e).then((function(){return t.success&&c.resetForm()}))}(e,c)},children:function(e){var t=e.errors,n=e.touched;e.isValidating;return Object(B.jsxs)(X.b,{children:[Object(B.jsx)(ee.a,{visible:!(!t.login||!n.login),placement:"right",title:Object(B.jsx)("span",{children:t.login}),children:Object(B.jsx)(X.a,{id:"login",name:"login",placeholder:"login",validate:Y})}),Object(B.jsx)(ee.a,{visible:!(!t.password||!n.password),placement:"left",title:Object(B.jsx)("span",{children:t.password}),children:Object(B.jsx)(X.a,{id:"password",name:"password",placeholder:"password",validate:Z})}),Object(B.jsx)(X.a,{id:"repeatPassword",name:"repeatPassword",placeholder:"repeat password"}),Object(B.jsx)("button",{type:"submit",children:"Submit"})]})}}),Object(B.jsx)("div",{className:"error",children:Object(B.jsx)("span",{children:t.error})})," ",Object(B.jsx)("div",{className:"success",children:Object(B.jsx)("span",{children:t.success})})]})})),ne=function(){var e=Object(o.d)(M);return Object(B.jsx)("main",{children:e.isAuth?Object(B.jsx)(K,{}):Object(B.jsxs)(F.c,{children:[Object(B.jsx)(F.a,{path:"/login",children:Object(B.jsx)($,{})}),Object(B.jsx)(F.a,{path:"/registration",children:Object(B.jsx)(te,{})})]})})};var ce=function(){var e=Object(o.c)();Object(c.useEffect)((function(){e(A)}),[]);var t=Object(o.d)(M);return Object(B.jsx)("div",{children:t.initApp&&Object(B.jsxs)("div",{className:"App",children:[Object(B.jsx)(D,{}),Object(B.jsx)(ne,{})]})})};var re=function(){return Object(B.jsx)(a.a,{children:Object(B.jsx)(o.a,{store:G,children:Object(B.jsx)(ce,{})})})};i.a.render(Object(B.jsx)(r.a.StrictMode,{children:Object(B.jsx)(re,{})}),document.getElementById("root"))}},[[340,1,2]]]);
//# sourceMappingURL=main.ccd28a53.chunk.js.map